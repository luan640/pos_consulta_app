{% extends 'base.html' %}
{% load static %}

{% block title %}Pacientes | Health SaaS{% endblock %}
{% block nav_pacientes_active %}bg-primary/10 text-primary{% endblock %}
{% block nav_pacientes_aria %}aria-current="page"{% endblock %}

{% block content %}
<div class="flex flex-col gap-6 h-full">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <h1 class="text-2xl font-bold text-[#111518] tracking-tight">Pacientes</h1>
        <button id="btn-novo-paciente" type="button"
            class="inline-flex items-center gap-2 px-4 py-2.5 bg-primary hover:bg-blue-600 text-white text-sm font-bold rounded-lg shadow-sm transition-colors">
            <span class="material-symbols-outlined text-[18px]">person_add</span>
            Novo paciente
        </button>
    </div>

        <!-- Filters & Search -->
        <form id="pacientes-filtros"
            class="bg-white p-4 rounded-xl border border-[#e5e7eb] shadow-sm flex flex-col md:flex-row gap-4">
            <div class="flex-1 relative">
                <span
                    class="absolute left-3 top-1/2 -translate-y-1/2 text-[#617989] material-symbols-outlined">search</span>
                <input id="filtro-nome"
                    class="w-full pl-10 pr-4 py-2.5 bg-white border border-[#dbe1e6] rounded-lg text-sm text-[#111518] focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-[#94a3b8]"
                    placeholder="Buscar por nome..." type="text" />
            </div>
            <div class="w-full md:w-64 relative">
                <span
                    class="absolute left-3 top-1/2 -translate-y-1/2 text-[#617989] material-symbols-outlined">call</span>
                <input id="filtro-telefone"
                    class="w-full pl-10 pr-4 py-2.5 bg-white border border-[#dbe1e6] rounded-lg text-sm text-[#111518] focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-[#94a3b8]"
                    placeholder="Buscar por telefone..." type="text" />
            </div>
            <div class="flex gap-2">
                <button type="submit"
                    class="px-4 py-2.5 bg-primary hover:bg-blue-600 text-white text-sm font-bold rounded-lg shadow-sm transition-colors">Buscar</button>
                <button type="button" id="filtro-limpar"
                    class="px-4 py-2.5 bg-white border border-[#dbe1e6] text-[#111518] text-sm font-bold rounded-lg hover:bg-gray-50 transition-colors">Limpar</button>
            </div>
        </form>

        <!-- Table List -->
        <div class="bg-white border border-[#e5e7eb] rounded-xl shadow-sm overflow-hidden flex flex-col flex-1">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-[#f8fafc] border-b border-[#e5e7eb]">
                        <tr>
                            <th class="py-3 px-4 text-xs font-semibold text-[#64748b] uppercase tracking-wider">Nome do
                                Paciente</th>
                            <th class="py-3 px-4 text-xs font-semibold text-[#64748b] uppercase tracking-wider">Telefone
                            </th>
                            <th class="py-3 px-4 text-xs font-semibold text-[#64748b] uppercase tracking-wider">Criado
                                em</th>
                            <th
                                class="py-3 px-4 text-xs font-semibold text-[#64748b] uppercase tracking-wider text-right">
                                Ações</th>
                        </tr>
                    </thead>
                    <tbody id="pacientes-tbody" class="divide-y divide-[#f1f5f9]">
                        <!-- Linhas inseridas via JS -->
                    </tbody>
                </table>
            </div>
            <div id="pacientes-vazio" class="hidden text-center text-slate-500 py-8">
                <span class="material-symbols-outlined text-4xl mb-2">person_off</span>
                <p>Nenhum paciente encontrado.</p>
            </div>
            <!-- Pagination (Static for now, JS usage unknown) -->
            <div class="px-4 py-3 border-t border-[#e5e7eb] flex items-center justify-between bg-white">
                <span id="pacientes-paginacao-status" class="text-sm text-[#64748b]">Mostrando resultados</span>
                <div class="flex gap-2">
                    <button id="pacientes-prev"
                        class="px-3 py-1 text-sm border border-[#e5e7eb] rounded bg-white text-[#64748b] hover:bg-gray-50 disabled:opacity-50">Anterior</button>
                    <button id="pacientes-next"
                        class="px-3 py-1 text-sm border border-[#e5e7eb] rounded bg-white text-[#64748b] hover:bg-gray-50 disabled:opacity-50">Próximo</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Novo paciente -->
<div id="novoPacienteModal" class="fixed inset-0 z-50 hidden" aria-labelledby="novo-paciente-title" role="dialog"
    aria-modal="true">
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" data-modal-hide="novoPacienteModal"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:items-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <form id="novo-paciente-form">
                    <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="text-base font-semibold leading-6 text-gray-900" id="novo-paciente-title">Novo Paciente
                            </h5>
                            <button type="button" class="text-gray-400 hover:text-gray-500"
                                data-modal-hide="novoPacienteModal">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                        <div class="space-y-5">
                            <div class="flex flex-col gap-4">
                                <h3 class="text-xs font-semibold text-[#617989] uppercase tracking-wide">Dados Pessoais</h3>
                                <label class="flex flex-col gap-1.5">
                                    <span class="text-sm font-medium text-[#111518]">Nome Completo</span>
                                    <input id="novo-paciente-nome" required
                                        class="w-full px-3 py-2 bg-white border border-[#dbe1e6] rounded-lg text-sm focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-[#94a3b8]"
                                        placeholder="Ex: Joao da Silva" type="text" />
                                </label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <label class="flex flex-col gap-1.5">
                                        <span class="text-sm font-medium text-[#111518]">WhatsApp</span>
                                        <input id="novo-paciente-telefone"
                                            class="w-full px-3 py-2 bg-white border border-[#dbe1e6] rounded-lg text-sm focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-[#94a3b8]"
                                            placeholder="(00) 00000-0000" type="tel" />
                                    </label>
                                    <label class="flex flex-col gap-1.5">
                                        <span class="text-sm font-medium text-[#111518]">Data Consulta</span>
                                        <input id="novo-paciente-data" required
                                            class="w-full px-3 py-2 bg-white border border-[#dbe1e6] rounded-lg text-sm focus:border-primary focus:ring-1 focus:ring-primary text-[#64748b]"
                                            type="date" />
                                    </label>
                                </div>
                            </div>
                            <hr class="border-[#f0f3f4]" />
                            <div class="flex flex-col gap-4">
                                <h3 class="text-xs font-semibold text-[#617989] uppercase tracking-wide">Detalhes</h3>
                                <label class="flex flex-col gap-1.5">
                                    <span class="text-sm font-medium text-[#111518]">Tipo de Consulta</span>
                                    <select id="novo-paciente-tipo"
                                        class="w-full px-3 py-2 bg-white border border-[#dbe1e6] rounded-lg text-sm focus:border-primary focus:ring-1 focus:ring-primary text-[#111518]">
                                        <option value="consulta">Consulta</option>
                                        <option value="retorno">Retorno</option>
                                    </select>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                        <button type="submit"
                            class="inline-flex w-full justify-center rounded-md bg-primary px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-600 sm:ml-3 sm:w-auto">Salvar Paciente</button>
                        <button type="reset"
                            class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Limpar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Editar paciente (Preserved Bootstrap for now, hidden) -->
<!-- Modal: Editar paciente -->
<div id="editarPacienteModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
    aria-modal="true">
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" data-modal-backdrop></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:items-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md">
                <form id="editar-paciente-form">
                    <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Editar paciente
                            </h5>
                            <button type="button" class="text-gray-400 hover:text-gray-500"
                                data-modal-hide="editarPacienteModal">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                        <div class="space-y-4">
                            <input type="hidden" id="editar-paciente-id">
                            <div>
                                <label for="editar-paciente-nome"
                                    class="block text-sm font-medium leading-6 text-gray-900">Nome</label>
                                <input type="text" id="editar-paciente-nome"
                                    class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
                                    required>
                            </div>
                            <div>
                                <label for="editar-paciente-telefone"
                                    class="block text-sm font-medium leading-6 text-gray-900">Telefone</label>
                                <input type="tel" id="editar-paciente-telefone"
                                    class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6">
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                        <button type="submit"
                            class="inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 sm:ml-3 sm:w-auto">Salvar</button>
                        <button type="button"
                            class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
                            data-modal-hide="editarPacienteModal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="module" src="{% static 'js/message.js' %}"></script>
<script type="module" src="{% static 'js/pacientes.js' %}"></script>
{% endblock %}


{% extends 'base.html' %}
{% load static %}

{% block title %}Materiais | LembraPro{% endblock %}
{% block nav_materiais_active %}active{% endblock %}
{% block nav_materiais_aria %}aria-current="page"{% endblock %}

{% block extra_css %}
<!-- Toast Styles preserved if needed, though we moved to Tailwind Toasts mostly? Keeping for safety -->
<link rel="stylesheet" href="{% static 'css/toast-styles.css' %}">
{% endblock %}

{% block content %}
<main class="flex-1 overflow-y-auto bg-slate-50 px-2 sm:px-3 md:px-4 py-4 rounded-xl relative">
    <div class="w-full max-w-none flex flex-col gap-6">
        <!-- Page Heading -->
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div class="flex flex-col gap-1">
                <h1 class="text-3xl font-bold text-[#111518] tracking-tight">Materiais Educativos</h1>
                <p class="text-slate-500 text-base">Gerencie arquivos, vídeos e links para compartilhar com seus
                    pacientes.</p>
            </div>
            <button id="btnNovoMaterial" type="button"
                class="flex items-center justify-center gap-2 rounded-lg bg-primary px-5 py-2.5 text-white shadow-sm shadow-primary/30 hover:bg-blue-600 transition-all active:scale-95"
                data-bs-toggle="modal" data-bs-target="#novoMaterialModal">
                <span class="material-symbols-outlined text-[20px]">add</span>
                <span class="font-semibold text-sm">Adicionar Material</span>
            </button>
        </div>

        <!-- Filters & Controls -->
        <div
            class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-[#e5e7eb]">
            <!-- Local Search -->
            <div class="w-full lg:w-96 relative">
                <span
                    class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">search</span>
                <input id="materiais-busca"
                    class="w-full h-11 rounded-lg border border-[#e5e7eb] bg-white pl-10 pr-4 text-sm text-[#111518] focus:border-primary focus:ring-1 focus:ring-primary transition-all"
                    placeholder="Buscar materiais por título..." type="text" />
            </div>
            <button id="materiais-filtrar" type="button"
                class="inline-flex items-center gap-2 px-4 py-2.5 bg-primary text-white text-sm font-semibold rounded-lg shadow-sm hover:bg-primary/90 transition-colors">
                <span class="material-symbols-outlined text-[18px]">filter_alt</span>
                Filtrar
            </button>
            <!-- Filter Chips -->
            <!-- <div class="flex flex-wrap gap-2 w-full lg:w-auto">
                <button
                    class="px-4 py-1.5 rounded-full bg-[#111518] text-white text-sm font-medium shadow-sm transition-colors">Todos</button>
                <button
                    class="px-4 py-1.5 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 text-sm font-medium transition-colors">PDFs</button>
                <button
                    class="px-4 py-1.5 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 text-sm font-medium transition-colors">Vídeos</button>
                <button
                    class="px-4 py-1.5 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 text-sm font-medium transition-colors">Links</button>
            </div> -->
            <!-- View Toggle (Visual only for now) -->
            <!-- <div class="hidden sm:flex bg-slate-100 p-1 rounded-lg">
                <button class="p-1.5 rounded bg-white shadow-sm text-[#111518]">
                    <span class="material-symbols-outlined text-[20px]">grid_view</span>
                </button>
                <button class="p-1.5 rounded text-slate-500 hover:text-[#111518] transition-colors">
                    <span class="material-symbols-outlined text-[20px]">view_list</span>
                </button>
            </div> -->
        </div>

        <!-- Materials Grid -->
        <div id="materiais-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-6">
            <!-- Cards rendered via JS -->
            <div class="col-span-full text-center py-10">
                <div class="spinner-border text-primary" role="status"></div>
                <div class="mt-2 text-slate-500">Carregando materiais...</div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="sem-materiais" class="flex flex-col items-center justify-center py-20 text-center hidden">
            <div class="bg-slate-100 p-6 rounded-full mb-4">
                <span class="material-symbols-outlined text-4xl text-slate-400">folder_open</span>
            </div>
            <h3 class="text-lg font-medium text-[#111518]">Nenhum material encontrado</h3>
            <p class="text-slate-500 max-w-sm mt-2">Comece adicionando PDFs, vídeos ou links para compartilhar com seus
                pacientes.</p>
        </div>

    </div>
</main>

<!-- Preserved Bootstrap Modals -->
<!-- Modal: Novo material -->
<!-- Modal: Novo Material -->
<div id="novoMaterialModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
    aria-modal="true">
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" data-modal-backdrop></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <form id="novo-material-form" enctype="multipart/form-data">
                    <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Novo Material
                            </h5>
                            <button type="button" class="text-gray-400 hover:text-gray-500"
                                data-modal-hide="novoMaterialModal">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                        <div class="space-y-4">
                            <p class="text-xs text-gray-500">Escolha um tipo de arquivo e envie apenas um.</p>
                            <div>
                                <label for="novo-material-nome"
                                    class="block text-sm font-medium leading-6 text-gray-900">Nome do Material</label>
                                <input type="text" id="novo-material-nome" name="descricao"
                                    class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
                                    required placeholder="Nome do Material">
                            </div>
                            <div>
                                <label for="novo-material-tipo"
                                    class="block text-sm font-medium leading-6 text-gray-900">Tipo de arquivo</label>
                                <select id="novo-material-tipo" name="tipo_arquivo"
                                    class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6">
                                    <option value="pdf" selected>PDF</option>
                                    <option value="imagem">Imagem</option>
                                    <option value="video">Video</option>
                                    <option value="youtube">Video do YouTube</option>
                                </select>
                            </div>
                            <div class="space-y-4">
                                <div class="material-arquivo-wrapper w-full">
                                    <label for="novo-material-pdf"
                                        class="block text-sm font-medium leading-6 text-gray-900">Anexar PDF</label>
                                    <input type="file" id="novo-material-pdf" name="arquivo_pdf"
                                        accept="application/pdf" data-tipo="pdf"
                                        class="material-arquivo-input mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
                                </div>
                                <div class="material-arquivo-wrapper w-full hidden">
                                    <label for="novo-material-video"
                                        class="block text-sm font-medium leading-6 text-gray-900">Anexar video</label>
                                    <input type="file" id="novo-material-video" name="arquivo_video" accept="video/*"
                                        data-tipo="video"
                                        class="material-arquivo-input mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
                                </div>
                                <div class="material-arquivo-wrapper w-full hidden">
                                    <label for="novo-material-youtube"
                                        class="block text-sm font-medium leading-6 text-gray-900">Link do
                                        YouTube</label>
                                    <input type="url" id="novo-material-youtube" name="youtube_url"
                                        placeholder="https://www.youtube.com/watch?v=..." data-tipo="youtube"
                                        class="material-arquivo-input mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6">
                                </div>
                                <div class="material-arquivo-wrapper w-full hidden">
                                    <label for="novo-material-imagem"
                                        class="block text-sm font-medium leading-6 text-gray-900">Anexar imagem</label>
                                    <input type="file" id="novo-material-imagem" name="arquivo_imagem" accept="image/*"
                                        data-tipo="imagem"
                                        class="material-arquivo-input mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                        <button type="submit"
                            class="inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 sm:ml-3 sm:w-auto">Salvar</button>
                        <button type="button"
                            class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
                            data-modal-hide="novoMaterialModal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Editar material -->
<div id="editarMaterialModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
    aria-modal="true">
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" data-modal-backdrop></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <form id="material-editar-form" enctype="multipart/form-data">
                    <input type="hidden" id="material-editar-id" name="material-id">
                    <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Editar material
                            </h5>
                            <button type="button" class="text-gray-400 hover:text-gray-500"
                                data-modal-hide="editarMaterialModal">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label for="material-editar-descricao"
                                    class="block text-sm font-medium leading-6 text-gray-900">Nome do Material</label>
                                <input type="text" id="material-editar-descricao" name="descricao"
                                    class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
                                    required placeholder="Nome do Material">
                            </div>
                            <div>
                                <label for="material-editar-tipo"
                                    class="block text-sm font-medium leading-6 text-gray-900">Tipo de arquivo</label>
                                <select id="material-editar-tipo" name="tipo_arquivo"
                                    class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6">
                                    <option value="pdf">PDF</option>
                                    <option value="imagem">Imagem</option>
                                    <option value="video">Video</option>
                                    <option value="youtube">Video do YouTube</option>
                                </select>
                            </div>
                            <div id="material-editar-arquivos" class="text-gray-500 text-xs mb-2"></div>
                            <div id="material-editar-remover-info" class="text-red-500 text-xs mb-3 hidden">
                                Arquivo sera removido ao salvar.
                            </div>
                            <div class="flex items-center mb-3 hidden">
                                <input type="checkbox" id="material-editar-remover" name="remover_arquivo" value="1"
                                    class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary">
                                <label for="material-editar-remover" class="ml-2 block text-sm text-gray-900">Remover
                                    arquivo atual</label>
                            </div>

                            <!-- Fields wrapper for JS targeting -->
                            <div class="material-arquivo-wrapper w-full">
                                <label for="material-editar-pdf"
                                    class="block text-sm font-medium leading-6 text-gray-900">Substituir PDF</label>
                                <input type="file" id="material-editar-pdf" name="arquivo_pdf" accept="application/pdf"
                                    data-tipo="pdf"
                                    class="material-arquivo-input mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
                            </div>
                            <div class="material-arquivo-wrapper w-full hidden">
                                <label for="material-editar-youtube"
                                    class="block text-sm font-medium leading-6 text-gray-900">Link do YouTube</label>
                                <input type="url" id="material-editar-youtube" name="youtube_url"
                                    placeholder="https://www.youtube.com/watch?v=..." data-tipo="youtube"
                                    class="material-arquivo-input mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6">
                            </div>
                            <div class="material-arquivo-wrapper w-full hidden">
                                <label for="material-editar-imagem"
                                    class="block text-sm font-medium leading-6 text-gray-900">Substituir imagem</label>
                                <input type="file" id="material-editar-imagem" name="arquivo_imagem" accept="image/*"
                                    data-tipo="imagem"
                                    class="material-arquivo-input mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
                            </div>
                            <div class="material-arquivo-wrapper w-full hidden">
                                <label for="material-editar-video"
                                    class="block text-sm font-medium leading-6 text-gray-900">Substituir video</label>
                                <input type="file" id="material-editar-video" name="arquivo_video" accept="video/*"
                                    data-tipo="video"
                                    class="material-arquivo-input mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                        <button type="submit"
                            class="inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 sm:ml-3 sm:w-auto">Salvar</button>
                        <button type="button"
                            class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
                            data-modal-hide="editarMaterialModal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Confirmar exclusao -->
<div id="excluirMaterialModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
    aria-modal="true">
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" data-modal-backdrop></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-sm">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="flex flex-col items-center justify-center text-center">
                        <div
                            class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 mb-4">
                            <span class="material-symbols-outlined text-2xl text-red-600">delete</span>
                        </div>
                        <h3 class="text-base font-semibold leading-6 text-gray-900 mb-2">Excluir material</h3>
                        <p class="text-sm text-gray-500">
                            Deseja excluir o material <strong id="excluir-material-nome"
                                class="text-gray-900">selecionado</strong>?
                        </p>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 justify-center">
                    <button type="button" id="confirmar-excluir-material"
                        class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Excluir</button>
                    <button type="button"
                        class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
                        data-modal-hide="excluirMaterialModal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Visualizar material -->
<div id="visualizarMaterialModal" class="fixed inset-0 z-50 hidden" aria-labelledby="visualizar-material-title"
    role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" data-modal-hide="visualizarMaterialModal"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="flex items-center justify-between mb-4">
                        <h5 class="text-base font-semibold leading-6 text-gray-900" id="visualizar-material-title">
                            Visualizar material
                        </h5>
                        <button type="button" class="text-gray-400 hover:text-gray-500"
                            data-modal-hide="visualizarMaterialModal">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <div id="visualizar-material-body" class="w-full">
                        <div class="flex items-center justify-center py-12 text-sm text-slate-500">
                            Carregando...
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button"
                        class="inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:w-auto"
                        data-modal-hide="visualizarMaterialModal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="module" src="{% static 'js/message.js' %}"></script>
<script type="module" src="{% static 'js/materiais.js' %}"></script>
{% endblock %}
